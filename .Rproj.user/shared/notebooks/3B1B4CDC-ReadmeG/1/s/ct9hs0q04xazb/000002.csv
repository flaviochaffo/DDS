"0","#DMMitre"
"0","library(jsonlite)"
"0","library(mitre)"
"0","library(burro)"
"0","library(dplyr)"
"0","library(ggplot2)"
"0","library(plyr)"
"0","library(markdown)"
"0","library(knitr)"
"0","library(stringr)"
"0","library(ggrepel)"
"0",""
"0","capec.relations <- data.frame(capec.relations)"
"0","mitre <- subset(capec.relations,capec.relations$name == ""ATTACK"")"
"0","mitre2 <- subset(capec.relations,capec.relations$name == ""ChildOf"")"
"0","mitre3 <- subset(capec.relations,capec.relations$name == ""take advantage of"")"
"0",""
"0","i <- 1"
"0","while (i <= nrow((CAPECordered)))"
"0","{"
"0","  aux <- list(subset(mitre,mitre$from == CAPECordered$CAPEC[i])[,3])"
"0","  if (length(grep(""T"",aux)) != 0)"
"0",""
"0","    {"
"0","      CAPECordered$Relations[i] <- aux"
"0","  }else{"
"0","    aux <- list(subset(mitre2,mitre2$from == CAPECordered$CAPEC[i])[,3])"
"0","    if (length(grep(""C"",aux)) != 0)"
"0",""
"0","        {"
"0","      CAPECordered$Relations[i] <- aux"
"0","         }else{"
"0","           aux <- list(subset(mitre3,mitre3$from == CAPECordered$CAPEC[i])[,3])"
"0",""
"0","           if(length(grep(""C"",aux)) != 0)"
"0","           {"
"0","             CAPECordered$Relations[i] <- aux"
"0",""
"0","           }else{"
"0",""
"0","                CAPECordered$Relations[i] <- 0"
"0","                  }"
"0","        }"
"0","  }"
"0",""
"0","  i <- i + 1"
"0","}"
"0",""
"0","test <- data.frame(CAPECordered[grep(""^T"",CAPECordered$Relations),])"
"0",""
"0","aux <- nrow(test)                               #Cuento todas las líneas de CWEs"
"0",""
"0","MITRE <- data.frame(str_split(test$Relations[1],"",""))                 #Llevo a un nuevo dataframe todas los CVEs del primer CPE"
"0","#CAPEC <- unlist(strsplit(CAPEC$CAPEC[1], split=':', fixed=TRUE))[2]"
"0","colnames(MITRE) <- ""Techniques""                               #Le pongo de nombre a la columna CVEs"
"0","i <- 2                                                #Auxiliar en 2"
"0",""
"0","while (i <= aux){                                     #Voy añadiendo al dataframe anterior todas las listas de CVEs que existen en el dataframe CPE"
"0",""
"0","  MITRE2 <- data.frame(str_split(test$Relations[i],"",""))"
"0","  colnames(MITRE2) <- ""Techniques"""
"0","  MITRE <- rbind(MITRE,MITRE2)"
"0","  distinct(MITRE)"
"0","  i <- i + 1"
"0","}"
"0",""
"0","i <- 2"
"0",""
"0","while (i <= nrow(MITRE)){"
"0","  j <- i - 1"
"0",""
"0","  while (j > 0){"
"0",""
"0","    if (MITRE[i,1] == MITRE[j,1]){"
"0",""
"0","      MITRE[i,1] <- 0"
"0","    }"
"0","    j <- j - 1"
"0",""
"0","  }"
"0",""
"0","  i <- i + 1"
"0","}"
"0",""
"0","MITREf <- data.frame(MITRE[1,])"
"0","colnames(MITREf) <- c(""Techniques"")"
"0","i <- 2"
"0",""
"0","while (i <= nrow(MITRE)){"
"0",""
"0","  if(MITRE[i,1] != 0){"
"0","    MITREf <- rbind(MITREf,MITRE[i,])"
"0","  }"
"0",""
"0","  i <- i + 1"
"0","}"
"0",""
"0","MITREf$total <- lapply(lapply(MITREf[,1],test$Relations,FUN = grep), length)"
"0","MITREf$pos <- lapply(MITREf[,1],test$Relations,FUN = grep)"
"0","MITREf$total <- as.numeric(MITREf[,2])"
"0","MITREordered <- MITREf[order(MITREf$total,decreasing = TRUE),]"
"0",""
"0","graphic1 <- ggplot(data = MITREordered, mapping = aes(x = total, y = Techniques, fill = as.factor(Techniques)))"
"0",""
"0","graphic1 + geom_bar(stat = 'identity') +"
"0","  xlab(""Total de Técnicas de Ataque"") +"
"0","  ylab(""Techniques"") +"
"0","  ggtitle(paste(""Gráfico de las técnicas de ataques presentes en"",producto,sep = "" "")) +"
"0","  labs(fill = ""Techniques"")"
